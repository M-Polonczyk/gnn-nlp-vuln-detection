{
  "func": "static int sysvipc_sem_proc_show(struct seq_file *s, void *it)\n{\n\tstruct user_namespace *user_ns = seq_user_ns(s);\n\tstruct sem_array *sma = it;\n\n\treturn seq_printf(s,\n\t\t\t  \"%10d %10d  %4o %10u %5u %5u %5u %5u %10lu %10lu\\n\",\n\t\t\t  sma->sem_perm.key,\n\t\t\t  sma->sem_perm.id,\n\t\t\t  sma->sem_perm.mode,\n\t\t\t  sma->sem_nsems,\n\t\t\t  from_kuid_munged(user_ns, sma->sem_perm.uid),\n\t\t\t  from_kgid_munged(user_ns, sma->sem_perm.gid),\n\t\t\t  from_kuid_munged(user_ns, sma->sem_perm.cuid),\n\t\t\t  from_kgid_munged(user_ns, sma->sem_perm.cgid),\n\t\t\t  sma->sem_otime,\n\t\t\t  sma->sem_ctime);\n}",
  "target": 0,
  "cwe": [
    "CWE-703",
    "CWE-189"
  ],
  "project": "linux",
  "commit_id": "6062a8dc0517bce23e3c2f7d2fea5e22411269a3",
  "hash": 149813976098753001835960306167987780941,
  "size": 18,
  "message": "ipc,sem: fine grained locking for semtimedop\n\nIntroduce finer grained locking for semtimedop, to handle the common case\nof a program wanting to manipulate one semaphore from an array with\nmultiple semaphores.\n\nIf the call is a semop manipulating just one semaphore in an array with\nmultiple semaphores, only take the lock for that semaphore itself.\n\nIf the call needs to manipulate multiple semaphores, or another caller is\nin a transaction that manipulates multiple semaphores, the sem_array lock\nis taken, as well as all the locks for the individual semaphores.\n\nOn a 24 CPU system, performance numbers with the semop-multi\ntest with N threads and N semaphores, look like this:\n\n\tvanilla\t\tDavidlohr's\tDavidlohr's +\tDavidlohr's +\nthreads\t\t\tpatches\t\trwlock patches\tv3 patches\n10\t610652\t\t726325\t\t1783589\t\t2142206\n20\t341570\t\t365699\t\t1520453\t\t1977878\n30\t288102\t\t307037\t\t1498167\t\t2037995\n40\t290714\t\t305955\t\t1612665\t\t2256484\n50\t288620\t\t312890\t\t1733453\t\t2650292\n60\t289987\t\t306043\t\t1649360\t\t2388008\n70\t291298\t\t306347\t\t1723167\t\t2717486\n80\t290948\t\t305662\t\t1729545\t\t2763582\n90\t290996\t\t306680\t\t1736021\t\t2757524\n100\t292243\t\t306700\t\t1773700\t\t3059159\n\n[davidlohr.bueso@hp.com: do not call sem_lock when bogus sma]\n[davidlohr.bueso@hp.com: make refcounter atomic]\nSigned-off-by: Rik van Riel <riel@redhat.com>\nSuggested-by: Linus Torvalds <torvalds@linux-foundation.org>\nAcked-by: Davidlohr Bueso <davidlohr.bueso@hp.com>\nCc: Chegu Vinod <chegu_vinod@hp.com>\nCc: Jason Low <jason.low2@hp.com>\nReviewed-by: Michel Lespinasse <walken@google.com>\nCc: Peter Hurley <peter@hurleysoftware.com>\nCc: Stanislav Kinsbursky <skinsbursky@parallels.com>\nTested-by: Emmanuel Benisty <benisty.e@gmail.com>\nTested-by: Sedat Dilek <sedat.dilek@gmail.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>"
}